{% extends 'base.html' %}
{% load static %}

{% block content %}
  <h2>Детали заказа #{{ order.id }}</h2>
  <ul>
    <!-- Данные грузоотправителя -->
    <li>
      <strong>Грузоотправитель:</strong>
      {{ order.shipper.user.company_name }} (VAT: 
      {% if order.shipper.vat_number %}
        {{ order.shipper.vat_number }}
      {% else %}
        Не указан
      {% endif %})
    </li>

    <!-- Пункт загрузки -->
    <li>
      <strong>Пункт загрузки:</strong>
      {% if order.loading_points %}
        {% for point in order.loading_points %}
          {{ point.city }} ({{ point.coordinates|join:", " }})
          {% if not forloop.last %}; {% endif %}
        {% endfor %}
      {% else %}
        Не указано
      {% endif %}
    </li>

    <!-- Пункт выгрузки -->
    <li>
      <strong>Пункт выгрузки:</strong>
      {% if order.unloading_points %}
        {% for point in order.unloading_points %}
          {{ point.city }} ({{ point.coordinates|join:", " }})
          {% if not forloop.last %}; {% endif %}
        {% endfor %}
      {% else %}
        Не указано
      {% endif %}
    </li>

    <!-- Если в заказе есть грузовые позиции, выводим данные первого элемента -->
    <li>
      <strong>Тип груза:</strong>
      {% if order.cargo_item.all %}
        {% with first_item=order.cargo_item.all.0 %}
          {{ first_item.name }}
        {% endwith %}
      {% else %}
        Не указано
      {% endif %}
    </li>
    <li>
      <strong>Вес:</strong>
      {% if order.cargo_item.all %}
        {% with first_item=order.cargo_item.all.0 %}
          {{ first_item.weight }} кг
        {% endwith %}
      {% else %}
        -
      {% endif %}
    </li>
    <li>
      <strong>Объём:</strong>
      {% if order.cargo_item.all %}
        {% with first_item=order.cargo_item.all.0 %}
          {{ first_item.volume }} м³
        {% endwith %}
      {% else %}
        -
      {% endif %}
    </li>
    <li>
      <strong>Дата создания:</strong> {{ order.created_at|date:"d.m.Y H:i" }}
    </li>
  </ul>

  <!-- Форма для принятия заказа (создания контракта) -->
  <form method="post" action="{% url 'orders:create_contract' %}">
    {% csrf_token %}
    <input type="hidden" name="order_id" value="{{ order.id }}">
    <button type="submit">Принять заказ</button>
  </form>
  
  <a href="{% url 'orders:cargo_order_list' %}">Назад к списку заказов</a>
{% endblock %}
